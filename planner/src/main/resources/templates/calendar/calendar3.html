<!DOCTYPE html>
<html lang='ko'>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- jQuery -->
    <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>

    <!-- jQuery UI -->
    <link rel="stylesheet" href="/webjars/jquery-ui/1.13.1/jquery-ui.css">
    <script src="/webjars/jquery-ui/1.13.1/jquery-ui.js"></script>

    <!-- flatpickr (미니 달력) -->
    <link rel="stylesheet" href="/webjars/flatpickr/4.6.13/dist/flatpickr.min.css">
    <script src="/webjars/flatpickr/4.6.13/dist/flatpickr.min.js"></script>
    <script src="/webjars/flatpickr/4.6.13/dist/l10n/ja.js"></script>

    <!-- fullcalendar (메인 달력) -->
    <script src='/webjars/fullcalendar/6.1.10/index.global.min.js'></script>

    <!-- bootstrap -->
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.2/css/bootstrap.min.css">
    <script src="/webjars/bootstrap/5.3.2/js/bootstrap.min.js"></script>

    <!-- moment -->
    <script src="/webjars/moment/2.30.1/min/moment.min.js"></script>

    <link href="/css/calendar/mini-calendar.css" rel="stylesheet">
    <link href="/css/calendar/plan.css" rel="stylesheet">

    <title>Calendar3</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            width: 1900px;
        }

        .calendar {
            display: flex;
            width: 100%;
            padding-top: 40px;
            justify-content: space-evenly;
        }

        #main-calendar {
            width: 50%;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var mainCalendar;
            var calendarEl = document.getElementById('main-calendar');
            mainCalendar = new FullCalendar.Calendar(calendarEl, {
                // 캘린더 설정
                headerToolbar: {
                    left: 'prevYear,prev,next,nextYear today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                },
                initialView: 'dayGridMonth',
                contentHeight: 300,
                navLinks: true,
                selectable: true,
                editable: true,
                droppable: true,
                dayMaxEventRows: true,
                fixedWeekCount: false,
                locale: 'ko',

                eventClick: function (info) {
                    if (confirm('일정을 삭제하시겠습니까?')) {
                        info.event.remove();
                    }
                },
                // 이벤트 드래그 앤 드롭 이벤트
                eventDrop: function (info) {
                    if (!confirm("일정을 이동하시겠습니까?")) {
                        info.revert();
                    }
                },
                // 이벤트 리사이즈 이벤트
                eventResize: function (info) {
                    if (!confirm("일정을 변경하시겠습니까?")) {
                        info.revert();
                    }
                }
            });

            // 캘린더 렌더링
            mainCalendar.render();

            // 저장 버튼 클릭 시
            document.getElementById('iuButton').addEventListener('click', function(event) {
                event.preventDefault();

                // HTML 폼의 값 가져오기
                var title = document.getElementById('title').value;
                var startDateTime = document.getElementById('startDate').value;
                var endDateTime = document.getElementById('endDate').value;
                var place = document.getElementById('place').value;
                var content = document.getElementById('content').value;

                // 시작일과 종료일을 FullCalendar의 ISO 8601 형식에 맞게 조정
                var startDateTimeParts = startDateTime.split('T');
                var endDateTimeParts = endDateTime.split('T');
                var startDate = startDateTimeParts[0];
                var startTime = startDateTimeParts[1] ? startDateTimeParts[1] : ''; // 시간이 입력되었을 경우만 추가
                var endDate = endDateTimeParts[0];
                var endTime = endDateTimeParts[1] ? endDateTimeParts[1] : ''; // 시간이 입력되었을 경우만 추가

                // 이벤트 객체 생성
                var eventObj = {
                    title: title,
                    start: startDate + (startTime ? 'T' + startTime : ''),
                    end: endDate + (endTime ? 'T' + endTime : ''),
                    allDay: !startTime && !endTime, // 시간이 없으면 allDay로 설정
                    extendedProps: {
                        place: place,
                        content: content,
                        // 다른 필드도 필요한 경우 여기에 추가하세요
                    }
                };

                // 이벤트 추가
                mainCalendar.addEvent(eventObj);

                // 이벤트 추가 후 폼 초기화
                document.getElementById('eventForm').reset();
            });

        });
    </script>


</head>

<body>
<div class="calendar">

    <!-- 메인 달력 -->
    <div id="main-calendar"></div>

    <!-- 일정 입력 폼 -->
    <div>
        <form id="eventForm">
            <table>
                <h3 id="eventTag">일정</h3>
                <tr>
                    <td colspan="2">
                        <input id="title" class="form-control" placeholder="제목 및 시간 추가" onfocus="this.placeholder=''"
                               onblur="this.placeholder='제목 및 시간 추가'" size="27px">
                    </td>
                </tr>
                <tr>
                    <td>
                        하루종일 <input type="checkbox" id="allDay" name="allDay" checked>
                    </td>
                </tr>
                <tr>
                    <td id="mini-calendar-input">
                        시작일 <input id="startDate" class="form-control">
                        종료일 <input id="endDate" class="form-control">
                    </td>
                </tr>
                <tr id="timeInputs">
                    <td>
                        시작시간 <select id="startTime" class="form-control"></select>
                        종료시간 <select id="endTime" class="form-control"></select>
                    </td>
                </tr>
                <tr>
                    <td>
                        장소 <input id="place" name="place" class="form-control">
                    </td>
                </tr>
                <tr>
                    <td>
                        <select id="repeat" class="form-select" aria-label="Default select example">
                            <option value="1">반복안함</option>
                            <option value="2">매일</option>
                            <option value="3">매주</option>
                            <option value="4">평일</option>
                            <option value="5">주말</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                          <textarea id="content" class="form-control" placeholder="설명 추가"
                                    onfocus="this.placeholder=''" onblur="this.placeholder='설명 추가'" cols="30" rows="4"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        알람 <input type="checkbox" id="alarm" name="alarm" checked>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" align="right">
                        <button id="iuButton" class="btn btn-primary">저장</button>
                        <button type="hidden" id="deletePlan" class="btn btn-primary">삭제</button>
                    </td>
                </tr>
            </table>
            <br>
            <input id="id" name="id">
            <input type="hidden" id="userEmail" name="userEmail">
        </form>
    </div>
</div>
<script src="/js/calendar/timeSettings.js"></script>
</body>
</html>